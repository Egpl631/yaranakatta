<!doctype html>
<html lang="ja">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>やらなかったリスト</title>
<style>
  body{font-family:-apple-system,system-ui; margin:0; background:#f6f7fb;}
  .wrap{max-width:520px; margin:0 auto; padding:28px;}
  h1{font-size:20px; margin:8px 0 24px;}
  .count{font-size:18px; margin-bottom:24px;}
  button{width:100%; padding:22px; font-size:22px; color:#fff; background:#2f6feb; border:0; border-radius:16px;}
  .chips{display:flex; gap:8px; overflow:auto; margin:16px 0;}
  .chip{padding:8px 12px; background:#e9ecf7; border-radius:999px; white-space:nowrap; font-size:14px;}
  .log{margin-top:24px;}
  .item{background:#fff; padding:12px; border-radius:12px; margin-bottom:8px; font-size:14px;}
</style>
<div class="wrap">
  <h1>やらなかったリスト</h1>
  <div class="count">今日は <b id="cnt">0</b> 回、誘惑に勝利！</div>
  <button id="btn">やらなかった！</button>
  <div class="chips" id="chips"></div>
  <div class="log" id="log"></div>
</div>
<script>
  const TAGS = ["SNS","夜更かし","無駄遣い","間食","二度寝","先延ばし","愚痴","衝動買い"];
  const key = "yaranakatta_v1";
  const load = () => JSON.parse(localStorage.getItem(key)||"[]");
  const save = (arr) => localStorage.setItem(key, JSON.stringify(arr));
  const todayStr = () => new Date().toISOString().slice(0,10);

  const chips = document.getElementById('chips');
  TAGS.forEach(t=>{
    const c = document.createElement('span');
    c.className='chip'; c.textContent=t;
    c.onclick=()=>quickTag(t);
    chips.appendChild(c);
  });

  let data = load(); // [{ts, tag}]
  const btn = document.getElementById('btn');
  const cnt = document.getElementById('cnt');
  const log = document.getElementById('log');

  function render(){
    const today = todayStr();
    cnt.textContent = data.filter(d=>d.ts.startsWith(today)).length;
    log.innerHTML = data.slice().reverse().map(d=>{
      const dt = new Date(d.ts);
      const ds = dt.toLocaleString();
      return `<div class="item">${d.tag||"（未指定）"}　<span style="opacity:.6">${ds}</span></div>`;
    }).join('');
  }
  function add(tag=null){
    data.push({ts:new Date().toISOString(), tag});
    save(data); render(); haptic();
  }
  function quickTag(tag){ add(tag); }
  function haptic(){ if (window.navigator.vibrate) navigator.vibrate(10); }

  btn.onclick = ()=> add(null);
  render();

  // 簡易インストール用（PWA化）
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register(URL.createObjectURL(new Blob([`self.addEventListener('install',e=>self.skipWaiting());self.addEventListener('fetch',()=>{});`],{type:'text/javascript'})));
  }
</script>
</html>
