<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ã‚„ã‚‰ãªã‹ã£ãŸãƒªã‚¹ãƒˆ</title>

<!-- PWA ã£ã½ã„å…¨ç”»é¢åŒ– / ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼è‰² -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<style>
  :root{
    --bg1:#f7f9ff; --bg2:#edf1ff;
    --card:#ffffff; --text:#0b1324;
    --accent:#2f6feb; --accent-press:#265ad0;
    --chip:#e8edff;
    --shadow:0 10px 30px rgba(20,40,160,.12);
  }
  @media (prefers-color-scheme: dark){
    :root{
      --bg1:#0c1020; --bg2:#121833;
      --card:#171c33; --text:#e9edff;
      --accent:#6b8dff; --accent-press:#5876e0;
      --chip:#2a335e; --shadow:0 10px 30px rgba(0,0,0,.4);
    }
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font:16px/1.6 -apple-system, BlinkMacSystemFont, "Helvetica Neue", Arial, "Hiragino Sans", "Yu Gothic", sans-serif;
    color:var(--text);
    background: radial-gradient(1200px 700px at 10% 0%, var(--bg2), transparent),
                radial-gradient(1200px 700px at 90% 10%, var(--bg2), transparent),
                linear-gradient(180deg, var(--bg1), var(--bg2));
  }
  .wrap{max-width:560px; margin:0 auto; padding:28px 18px 48px}
  header h1{font-size:20px; margin:0 0 6px 0; letter-spacing:.2px}
  .count{
    font-size:18px; margin:8px 0 22px; opacity:.9
  }
  .card{
    background:var(--card); border-radius:20px; padding:18px; box-shadow:var(--shadow)
  }

  /* å¤§ãƒœã‚¿ãƒ³ */
  .cta{
    display:block; width:100%;
    background:var(--accent); color:#fff; border:0;
    border-radius:18px; padding:22px; font-size:22px; font-weight:700;
    transform:translateZ(0); transition:transform .08s ease, filter .15s ease, background .15s ease;
    box-shadow:0 8px 20px rgba(47,111,235,.25);
  }
  .cta:active{ transform:scale(.98); background:var(--accent-press); }

  /* ç§°è³›ãƒ¡ãƒƒã‚» */
  .cheer{ margin-top:14px; font-weight:600; min-height:24px; }

  /* ãƒãƒƒãƒ—ï¼ˆã‚¯ã‚¤ãƒƒã‚¯ã‚¿ã‚°ï¼‰ */
  .chips{ display:flex; gap:10px; overflow:auto; padding:10px 2px 4px; margin:12px 0 2px }
  .chip{
    flex:0 0 auto; padding:8px 12px; background:var(--chip); border-radius:999px;
    font-size:14px; cursor:pointer; user-select:none; transition:transform .06s ease;
  }
  .chip:active{ transform:scale(.97) }

  /* å±¥æ­´ */
  .section-title{ margin:22px 4px 10px; font-weight:700 }
  .log{ display:grid; gap:10px }
  .item{ background:var(--card); border-radius:14px; padding:12px 14px; box-shadow:var(--shadow); }
  .item small{ opacity:.7 }

  /* ç´™å¹é›ª */
  #confetti{ position:fixed; inset:0; pointer-events:none; overflow:hidden }
  .confetti{
    position:absolute; width:10px; height:14px; opacity:.9;
    will-change: transform, opacity;
  }

  /* ä½™ç™½èª¿æ•´ */
  .spacer{ height:14px }
</style>
</head>
<body>
<div id="confetti"></div>

<div class="wrap">
  <header>
    <h1>ã‚„ã‚‰ãªã‹ã£ãŸãƒªã‚¹ãƒˆ</h1>
    <div class="count">ä»Šæ—¥ã¯ <b id="cnt">0</b> å›ã€èª˜æƒ‘ã«å‹åˆ©ï¼</div>
  </header>

  <div class="card">
    <button id="btn" class="cta">ã‚„ã‚‰ãªã‹ã£ãŸï¼</button>
    <div id="cheer" class="cheer"></div>
  </div>

  <div class="spacer"></div>

  <div class="card">
    <div style="font-weight:700">ã‚¯ã‚¤ãƒƒã‚¯ã‚¿ã‚°</div>
    <div id="chips" class="chips"></div>
  </div>

  <div class="section-title">æœ€è¿‘ã®è¨˜éŒ²</div>
  <div id="log" class="log"></div>
</div>

<script>
  /* ====== è¨­å®š ====== */
  const TAGS = ["SNS","å¤œæ›´ã‹ã—","ç„¡é§„é£ã„","é–“é£Ÿ","äºŒåº¦å¯","å…ˆå»¶ã°ã—","æ„šç—´","è¡å‹•è²·ã„"];
  const CHEERS = ["ãˆã‚‰ã„ï¼","ä»Šæ—¥ã‚‚å‹åˆ©âœ¨","ãƒŠã‚¤ã‚¹æˆ‘æ…¢ï¼","ã„ã„åˆ¤æ–­ï¼","æœ€é«˜ï¼","è‡ªåˆ†ã‚’è¤’ã‚ã‚ˆã†ğŸ‘"];
  const KEY = "yaranakatta_v2";

  /* ====== ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ====== */
  const $ = s => document.querySelector(s);
  const todayISO = () => new Date().toISOString().slice(0,10);
  const load = () => JSON.parse(localStorage.getItem(KEY) || "[]");
  const save = (arr) => localStorage.setItem(KEY, JSON.stringify(arr));
  const vibrate = (ms=12) => navigator.vibrate && navigator.vibrate(ms);

  /* ====== çŠ¶æ…‹ ====== */
  let data = load(); // {ts, tag}

  /* ====== UIåˆæœŸåŒ– ====== */
  function render(){
    // ä»Šæ—¥ã®å›æ•°
    const t = todayISO();
    $("#cnt").textContent = data.filter(d => d.ts.startsWith(t)).length;

    // å±¥æ­´
    $("#log").innerHTML = data.slice().reverse().map(d=>{
      const dt = new Date(d.ts);
      const ds = dt.toLocaleString();
      const label = d.tag || "ï¼ˆæœªæŒ‡å®šï¼‰";
      return `<div class="item"><div>${label}</div><small>${ds}</small></div>`;
    }).join('');
  }

  // ã‚¿ã‚°ã®ä¸¦ã³ï¼šæœ€è¿‘ã‚ˆãä½¿ã£ãŸã‚‚ã®ã‚’å‰ã¸
  function tagOrder(){
    const count = {};
    data.forEach(d => { if (d.tag) count[d.tag] = (count[d.tag]||0)+1; });
    const sorted = [...TAGS].sort((a,b)=>(count[b]||0)-(count[a]||0));
    return sorted;
  }
  function mountChips(){
    const box = $("#chips"); box.innerHTML = "";
    tagOrder().forEach(t=>{
      const el = document.createElement("div");
      el.className="chip"; el.textContent=t;
      el.onclick=()=> add(t);
      box.appendChild(el);
    });
  }

  /* ====== ç´™å¹é›ª ====== */
  function confettiBurst(x=window.innerWidth/2,y=window.innerHeight/3){
    const colors = ["#ff6b6b","#ffd93d","#6bcB77","#4d96ff","#b07dff","#ffa3a3","#ffe08a","#a5f3a1"];
    const n = 26, root = $("#confetti");
    for(let i=0;i<n;i++){
      const p = document.createElement("div");
      p.className="confetti";
      p.style.background = colors[Math.floor(Math.random()*colors.length)];
      const size = 8 + Math.random()*8;
      p.style.width = size + "px"; p.style.height = (size*1.2) + "px";
      p.style.left = (x - 40 + Math.random()*80) + "px";
      p.style.top = (y - 10 + Math.random()*20) + "px";
      p.style.transform = `rotate(${Math.random()*360}deg)`;
      root.appendChild(p);

      // ã‚¢ãƒ‹ãƒ¡
      const dx = (Math.random()-0.5)*160;
      const dy = 240 + Math.random()*120;
      const rot = (Math.random()>0.5?1:-1)*(200+Math.random()*300);
      const start = performance.now();
      const dur = 700 + Math.random()*300;

      (function anim(t){
        const k = Math.min(1,(t-start)/dur);
        const ease = 1 - Math.pow(1-k, 2);
        p.style.transform = `translate(${dx*ease}px, ${dy*ease}px) rotate(${rot*ease}deg)`;
        p.style.opacity = String(1 - k);
        if(k<1) requestAnimationFrame(anim); else p.remove();
      })(start);
    }
  }

  /* ====== è¿½åŠ å‡¦ç† ====== */
  function add(tag=null){
    data.push({ ts:new Date().toISOString(), tag });
    save(data); render(); mountChips();
    // è§¦è¦š + ç§°è³› + ç´™å¹é›ª
    vibrate(12);
    const cheer = CHEERS[Math.floor(Math.random()*CHEERS.length)];
    $("#cheer").textContent = cheer;
    const btn = $("#btn");
    const rect = btn.getBoundingClientRect();
    confettiBurst(rect.left + rect.width/2, rect.top + window.scrollY + rect.height/2);
  }

  /* ====== èµ·å‹•å‡¦ç† ====== */
  $("#btn").onclick = ()=> add(null);
  mountChips(); render();

  // PWA ç°¡æ˜“SWï¼ˆã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œã®åœŸå°ï¼‰
  if('serviceWorker' in navigator){
    const sw = `self.addEventListener('install',e=>self.skipWaiting()); self.addEventListener('fetch',()=>{});`;
    navigator.serviceWorker.register(URL.createObjectURL(new Blob([sw],{type:'text/javascript'})));
  }
</script>
</body>
</html>
